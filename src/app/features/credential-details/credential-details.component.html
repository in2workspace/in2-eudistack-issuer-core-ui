<button type="button" [routerLink]="['/organization/credentials']" class="back-button" aria-label="Back to credentials">
  <mat-icon class="back-icon" fontIcon="arrow_back"></mat-icon>
</button>
<div class="page-container">
  <h1>{{ "credentialDetails.title" | translate | capitalize }}</h1>
  @if (credentialType$() && credentialDetailsForm$() && credentialDetailsFormSchema$()) {
    <!-- BASIC INFO -->
    <mat-card class="basic-actions-card">
      <mat-card-content class="basic-actions-card-content">
        <div class="basic-actions-container flex-align-container">
          <div class="basic-info-container flex-align-main">
            <div class="basic-info">
              <span><b>{{ credentialType$() }}</b></span>
              <span class="status-ellipse" [class]="credentialStatusClass$()">{{ credentialStatus$() }}</span>
              <span><b>{{ "credentialDetails.valid_from" | translate | capitalize }}:</b> {{ credentialValidFrom$() | date: 'dd-MM-yyyy' }}</span>
              <span><b>{{ "credentialDetails.valid_until" | translate | capitalize }}:</b> {{ credentialValidUntil$() | date: 'dd-MM-yyyy' }}</span>
            </div>
          </div>
          <!-- ACTION BUTTONS -->
          @if(showActionsButtonsContainer$()){
            <div class="actions-container side-flexing">
              <!-- BUTTONS -->
              <div class="buttons-container">
                @if (showReminderButton$()) {
                <div class="btn-reminder">
                  <button
                    type="button"
                    mat-raised-button
                    color="primary"
                    [disabled]="isLoading$|async"
                    (click)="openSendReminderDialog()"
                    >
                    {{ "credentialDetails.sendReminderConfirm.title" | translate }}
                  </button>
                </div>
              }
              @if (showSignCredentialButton$()) {
                <div class="btn-sign">
                  <button
                  type="button"
                  mat-raised-button
                  color="primary"
                  (click)="openSignCredentialDialog()"
                  [disabled]="isLoading$|async"
                  >
                    {{ "credentialDetails.signCredentialConfirm.title" | translate }}
                  </button>
                </div>
              }
              @if (showRevokeCredentialButton$()){
                <div class="btn-sign" [appCustomTooltip]="tooltipText" [tooltipParams]="{ url: knowledgeBaseUrl }" [appCustomTooltipDisabled]="enableRevokeCredentialButton$()">
                  <button
                  type="button"
                  mat-raised-button
                  color="warn"
                  (click)="openRevokeCredentialDialog()"
                  [disabled]="(isLoading$ | async) || !enableRevokeCredentialButton$()"
                  
                  >
                    {{ "credentialDetails.revoke" | translate | capitalize}}
                  </button>
                </div>
              }
        </div>
      </div>
    }
        </div>
     </mat-card-content>
    </mat-card>

  

<form [formGroup]="credentialDetailsForm$()!" class="specific-details-container flex-align-container">
        <!-- MAIN CONTAINER -->
        <div class="main-container flex-align-main">
          <mat-card>
            <mat-card-content>
          @for (key of formKeys(credentialDetailsForm$()!); track key) {
            @if (credentialDetailsFormSchema$()![key].display === 'main') {
              @switch (getControlType(credentialDetailsForm$()!.get(key))) {

                @case ('group') {
                  <div [formGroupName]="key">
                    <h2>{{ key | addPrefix: 'credentialDetails.' | translate | capitalize }}</h2>
                    @if (key === 'compliance') {
                      @for (standard of formKeys(credentialDetailsForm$()!.get(key)); track standard) {
                        <div [formGroupName]="standard">
                          <h3>{{ standard }}</h3>
                          @for (field of formKeys(credentialDetailsForm$()!.get(key)!.get(standard)); track field) {
                            <mat-form-field appearance="fill">
                              <mat-label>{{ field | addPrefix: 'credentialDetails.' | translate | capitalize }}</mat-label>
                              <input matInput [formControlName]="field" />
                            </mat-form-field>
                          }
                        </div>
                      }
                    } 
                    @else if(key === 'power') {
                      <div class="powers-container">
                        @for (func of formKeys(credentialDetailsForm$()!.get(key)); track func) {
                          <p>{{ func }}</p>
                          <div [formGroupName]="func" class="functions-container">
                            <div class="toggles-container">
                              @for (action of formKeys(credentialDetailsForm$()!.get(key)!.get(func)); track action) {
                                <mat-slide-toggle
                                  [checked]="credentialDetailsForm$()!.get(key)!.get(func)!.get(action)!.value"
                                  disabled
                                  color="primary">
                                  {{ action }}
                                </mat-slide-toggle>
                              }
                            </div>
                          </div>
                        }
                      </div>
                    }
                    @else {
                      @for (childKey of formKeys(credentialDetailsForm$()!.get(key)); track childKey) {
                        @switch (getControlType(credentialDetailsForm$()!.get(key)!.get(childKey))) {
                
                          @case ('group') {
                            <div [formGroupName]="childKey">
                              <h3>{{ childKey | addPrefix: 'credentialDetails.' | translate | capitalize }}</h3>
                              @for (grandChildKey of formKeys(credentialDetailsForm$()!.get(key)!.get(childKey)); track grandChildKey) {
                                <mat-form-field appearance="fill">
                                  <mat-label>{{ grandChildKey | addPrefix: 'credentialDetails.' | translate | capitalize }}</mat-label>
                                  <input matInput [formControlName]="grandChildKey" />
                                </mat-form-field>
                              }
                            </div>
                          }
                
                          @case ('control') {
                            <div>
                              <mat-form-field appearance="fill">
                                <mat-label>{{ childKey | addPrefix: 'credentialDetails.' | translate | capitalize }}</mat-label>
                                <input matInput [formControlName]="childKey" />
                              </mat-form-field>
                            </div>
                          }
                
                        }
                      }
                    }
                  </div>
                }       
              }
            }
          }
        </mat-card-content>
          </mat-card>
        </div>
        
        <!-- END MAIN CONTAINER -->
         
        <!-- SIDE CONTAINER (as plain text) -->
        <div class="side-container side-flexing">
          <div class="side-card">
          @for (key of formKeys(credentialDetailsForm$()); track key) {
            @if (credentialDetailsFormSchema$()![key].display === 'side') {
              @switch (getControlType(credentialDetailsForm$()!.get(key))) {

                @case ('group') {
                    <h2>{{ key | addPrefix: 'credentialDetails.' | translate | capitalize }}</h2>
                    <mat-card-content>
                    @for (childKey of formKeys(credentialDetailsForm$()!.get(key)); track childKey) {
                      @switch (getControlType(credentialDetailsForm$()!.get(key)!.get(childKey))) {

                        @case ('group') {
                            <h3>{{ childKey | addPrefix: 'credentialDetails.' | translate | capitalize }}</h3>
                            @for (grandChildKey of formKeys(credentialDetailsForm$()!.get(key)!.get(childKey)); track grandChildKey) {
                              <h3>{{ grandChildKey | addPrefix: 'credentialDetails.' | translate | capitalize }}</h3>
                              <p>{{ credentialDetailsForm$()!.get(key)!.get(childKey)!.get(grandChildKey)!.value }}</p>
                            }
                          }
                          
                          @case ('control') {
                            <h3>{{ childKey | addPrefix: 'credentialDetails.' | translate | capitalize }}</h3>
                            <p>{{ credentialDetailsForm$()!.get(key)!.get(childKey)!.value }}</p>
                          }
                          
                        }
                      }
                    </mat-card-content>
                }

              }
            }
          }
        </div>
        </div>
      </form>
    }
</div>