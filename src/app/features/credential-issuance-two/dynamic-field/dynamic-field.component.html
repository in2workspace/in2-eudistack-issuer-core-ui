@if(abstractControl$() && fieldSchema$()) {
  @if (fieldSchema$().type === 'group' && groupFields$()) {
    <!-- Per als grups, mostrem el FormGroup especÃ­fic del camp -->
    <mat-card class="mb-4">
      <mat-card-content [formGroup]="group$()!">
        @for (field of fieldSchema$().groupFields | keyvalue; track $index) {
          <app-dynamic-field 
            [fieldName$]="field.key" 
            [fieldSchema$]="field.value" 
            [abstractControl$]="group$()!">
          </app-dynamic-field>
        }
      </mat-card-content>
    </mat-card>
  } @else {
    <!-- Controls individuals -->
    <mat-form-field appearance="outline" class="w-full" [formGroup]="parentFormGroup$()">
      <mat-label>{{ fieldName$() }}</mat-label>
      @if (fieldSchema$().controlType === 'number') {
        <input matInput type="number" [formControlName]="fieldName$()" [id]="fieldName$()" />
      } @else {
        <input matInput type="text" [formControlName]="fieldName$()" [id]="fieldName$()" />
      }

      <mat-error *ngIf="control$()?.invalid && control$()?.touched">
        Invalid {{ fieldName$() }}
      </mat-error>
    </mat-form-field>
  }
}
