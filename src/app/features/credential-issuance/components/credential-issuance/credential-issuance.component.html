@let selectedCredentialType = selectedCredentialType$();
@let credentialFormSchema = credentialFormSchema$();

<div class="page-container">
  <h1>{{ "credentialIssuance.title" | translate }}</h1> 
  <div class="main-container">
    <!-- CREDENTIAL TYPE SELECTOR -->
    <mat-card class="type-selector-card">
      <mat-card-content>
        <div class="type-selector-container">
          <h2>{{ "credentialIssuance.select-type" | translate }}</h2>
          <mat-form-field appearance="fill">
            <mat-label>{{ "credentialIssuance.credentialType" | translate }}</mat-label>
            <mat-select 
              #select
              [value]="selectedCredentialType" 
              (selectionChange)="onSelectionChange($event.value, select)">
              @for(credentialType of credentialTypesArr; track $index){
                <mat-option 
                  [value]="credentialType">
                  {{ credentialType }}
                </mat-option>
              }
            </mat-select>
          </mat-form-field>
        </div>
        </mat-card-content>
    </mat-card>

    <!-- DATA CONTAINER -->
     @if(selectedCredentialType && credentialFormSchema && form){
       <div class="data-container">
         <!-- DYNAMIC CONTAINER (LEFT SIDE)-->
         <div class="dynamic-container">
           <mat-card>
             <mat-card-content>
               <!-- CREDENTIAL DATA CONTAINER -->
                 <div class="form-container">
                   <!-- MAIN FORM -->
                   @if (credentialFormSchema && form) {
                         <form [formGroup]="form!" (ngSubmit)="onSubmit()" novalidate>
                           @for (field of credentialFormSchema; track field.key) {
                             <!--  All first-level controls are currently groups -->
                             @if(field.custom){
                               <ng-container *ngComponentOutlet="field.custom.component; inputs: {form: form.get(field.key), updateMessages: updateAlertMessages.bind(this), data: field.custom.data}"></ng-container>
                              }
                              @else if(field.type === 'group'){ 
                                <h2 [class]="field.classes">{{ "credentialIssuance." + field.key | translate | titlecase }}</h2>
                               @for(subfield of field.groupFields; track subfield.key){
                                 <div class="form-fields">
                                   <app-dynamic-field [fieldName$]="subfield.key" [fieldSchema$]="subfield" [abstractControl$]="form.get(field.key)!"></app-dynamic-field>
                                 </div>
                               }
                             }
                           }
        

                           @if(bottomAlertMessages$().length > 0){
                            @for(msg of bottomAlertMessages$(); track $index){
                              <div class="missing-field-alert">{{ msg | translate }}</div>
                            }
                           }
     
                          <!-- todo -->
                            <div class="missing-field-alert"></div>
                           
                           <div class="buttons-container">
                             <button mat-flat-button type="submit">{{"credentialIssuance.cancel" | translate }}</button>
                             <button mat-raised-button color="primary" type="submit" [disabled]="!isGlobalValid$()">{{"credentialIssuance.create-credential" | translate }}</button>
                            </div>
                         </form>
                       }
                 </div>
             </mat-card-content>
           </mat-card>
         </div>
     
         <!-- STATIC CONTAINER (RIGHT SIDE)-->
         @if(staticData$()){
         <div class="static-container">
             @for(data of staticData$() | keyvalue; track $index){
               <h2>{{ "credentialIssuance." + data.key | translate | titlecase }}</h2>
               @for(fields of data.value; track $index){
                 <h5>{{ "credentialIssuance." + fields.key | translate }}</h5>
                 <p>{{ fields.value || "-" }}</p>
               }
             }
           </div>
         }
       </div>
     }
  </div>
</div>

